MVP Production Readiness Plan: Szybka Fucha
Summary
Comprehensive checklist of all tasks required to launch a fully functional MVP with backend integration (no dev mode). Based on analysis of both PRD documents and current implementation status.

Phase 1: Backend External Service Setup (Critical)
1.1 Twilio SMS Configuration (Phone Authentication)
Status: Mock Mode - Uses fixed OTP 123456
Required For: User registration via phone number

Setup Steps:

Create Twilio account at https://www.twilio.com/
Get credentials from Twilio Console
Purchase Polish phone number with SMS capabilities
Update backend/.env:

TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_PHONE_NUMBER=+48xxxxxxxxx
Test SMS delivery with real phone number
Reference: Backend file src/auth/auth.service.ts lines 37-48, 253-272
PRD Reference: Section 4.1 Authentication Module (AUTH-03, AUTH-04)

1.2 Stripe Payment Configuration
Status: Mock Mode - Returns fake payment intents
Required For: Task payments and contractor payouts

Setup Steps:

Create Stripe account at https://stripe.com/
Set up Stripe Connect (Express accounts for contractors)
Configure webhook endpoint: https://api.szybkafucha.pl/api/v1/payments/webhook
Get API keys from Stripe Dashboard
Update backend/.env:

STRIPE_SECRET_KEY=sk_live_xxxxxxxxxxxxxxxxxxxx  # or sk_test_ for testing
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxx
STRIPE_PLATFORM_FEE_PERCENT=17
Test payment flow end-to-end
Test Stripe Connect account creation for contractors
Test webhook event handling
Reference: Backend file src/payments/payments.service.ts lines 41-48
PRD Reference: Section 4.4 Payment Module (PAY-01 through PAY-07)

1.3 Firebase Cloud Messaging Configuration
Status: Mock Mode - Logs notifications to console
Required For: Push notifications (new tasks, messages, status updates)

Setup Steps:

Create Firebase project at https://console.firebase.google.com/
Enable Cloud Messaging in project settings
Generate service account key (JSON file)
Extract credentials from JSON file
Update backend/.env:

FIREBASE_PROJECT_ID=your-project-id
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project-id.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"
Test notification delivery on iOS and Android devices
Mobile Setup Required:

Add google-services.json to mobile/android/app/
Add GoogleService-Info.plist to mobile/ios/Runner/
Users must grant notification permissions
Reference: Backend file src/notifications/notifications.service.ts lines 33-44
PRD Reference: Section 4.5 Real-time Module (RT-04), Task 11.0 in tasks-prd

1.4 Onfido KYC Configuration (Optional for MVP)
Status: Mock Mode - Auto-approves verification after 5 seconds
Required For: Contractor identity verification

Setup Steps:

Sign up for Onfido account at https://onfido.com/
Get API token from Onfido Dashboard
Configure webhook endpoint: https://api.szybkafucha.pl/api/v1/kyc/webhook
Update backend/.env:

ONFIDO_API_TOKEN=api_live_xxxxxxxxxxxxxxxxxxxxxxxx
ONFIDO_REGION=EU
ONFIDO_WEBHOOK_SECRET=your_webhook_secret_here
Test ID verification flow
Test selfie verification
Test webhook event handling
Alternative: Launch MVP with manual verification via admin dashboard
Reference: Backend file src/kyc/kyc.service.ts lines 62-79
PRD Reference: Section 4.6 Verification Module (KYC-01 through KYC-06)

1.5 JWT Secret Configuration
Status: Using weak development secret
Required For: User session security

Setup Steps:

Generate strong random secret (minimum 32 characters):

openssl rand -base64 48
Update backend/.env:

JWT_SECRET=<GENERATED_STRONG_SECRET_HERE>
JWT_EXPIRES_IN=30d
Use different secrets for dev/staging/production environments
Reference: Backend file src/auth/auth.module.ts lines 20-31
PRD Reference: Section 5.3 Database Schema (users table)

1.6 Database Production Setup
Status: Configured for localhost development
Required For: Data persistence

Setup Steps:

Provision PostgreSQL 15+ with PostGIS extension
Create database and user
Update backend/.env:

DATABASE_HOST=your-db-host.com
DATABASE_PORT=5432
DATABASE_USERNAME=szybkafucha_prod
DATABASE_PASSWORD=<STRONG_PASSWORD_HERE>
DATABASE_NAME=szybkafucha_prod
CRITICAL: Disable TypeORM synchronization in production (set synchronize: false in app.module.ts)
Run any existing migrations
Set up database backups (daily recommended)
Reference: Backend file src/app.module.ts database configuration
PRD Reference: Section 5.3 Database Schema

1.7 Redis Production Setup
Status: Configured for localhost without password
Required For: OTP storage, caching, session management

Setup Steps:

Provision Redis 7+ instance
Enable password authentication
Update backend/.env:

REDIS_HOST=your-redis-host.com
REDIS_PORT=6379
REDIS_PASSWORD=<STRONG_PASSWORD_HERE>
Test OTP storage and retrieval
Reference: Backend file src/app.module.ts lines 76-84
PRD Reference: Section 5.1 System Overview

Phase 2: Mobile App Production Configuration (Critical)
2.1 API Base URL Configuration
Status: Hardcoded to localhost:3000
Required For: All API communication

Setup Steps:

Edit mobile/lib/core/api/api_config.dart:

// Line 5: DISABLE dev mode
static const bool devModeEnabled = false;

// Line 17: Change to production URL
static const String baseUrl = 'https://api.szybkafucha.pl/api/v1';
Reference: Mobile file lib/core/api/api_config.dart lines 5, 17
PRD Reference: Section 5.4 API Endpoints

2.2 WebSocket URL Configuration
Status: Hardcoded to ws://localhost:3000
Required For: Real-time features (chat, location tracking)

Setup Steps:

Edit mobile/lib/core/config/websocket_config.dart:

// Line 9: Change to production WebSocket URL
static const String webSocketUrl = 'wss://api.szybkafucha.pl';

// Line 52: DISABLE dev mode
static const bool devModeEnabled = false;
Reference: Mobile file lib/core/config/websocket_config.dart lines 9, 52
PRD Reference: Section 4.5 Real-time Module, Task 17.0 in tasks-prd

2.3 Google Sign-In Configuration
Status: No client IDs configured
Required For: Google OAuth authentication

Setup Steps:

A. Google Cloud Console:

Create project at https://console.cloud.google.com/
Enable Google Sign-In API
Create OAuth 2.0 credentials:
iOS: OAuth Client ID with bundle ID pl.szybkafucha.mobile
Android: OAuth Client ID with package name pl.szybkafucha.mobile and SHA-1 certificate fingerprint
Get Client IDs
B. iOS Configuration:

Edit mobile/ios/Runner/Info.plist:

<key>CFBundleURLTypes</key>
<array>
  <dict>
    <key>CFBundleURLSchemes</key>
    <array>
      <string>com.googleusercontent.apps.YOUR_IOS_CLIENT_ID</string>
    </array>
  </dict>
</array>
<key>GIDClientID</key>
<string>YOUR_IOS_CLIENT_ID.apps.googleusercontent.com</string>
C. Android Configuration:

Add google-services.json to mobile/android/app/
Android configuration is handled via google-services.json
Reference: Mobile file lib/core/services/google_sign_in_service.dart, mobile/docs/PRODUCTION_AUTH_SETUP.md
PRD Reference: Section 4.1 Authentication Module (AUTH-01)

2.4 Apple Sign-In Configuration
Status: Implementation complete, needs Apple Developer setup
Required For: Apple OAuth authentication

Setup Steps:

A. Apple Developer Portal:

Create App ID with "Sign in with Apple" capability
Create Service ID: pl.szybkafucha.mobile
Configure domains and return URLs
Create Key for "Sign in with Apple"
B. iOS Configuration:

Open Xcode project
Select Runner target → Signing & Capabilities
Add "Sign in with Apple" capability
C. Backend Configuration:

Backend expects Apple ID token from mobile app
No additional backend configuration needed
Reference: Mobile file lib/core/services/apple_sign_in_service.dart, mobile/docs/PRODUCTION_AUTH_SETUP.md
PRD Reference: Section 4.1 Authentication Module (AUTH-02)

2.5 Firebase Configuration (Mobile)
Status: Configuration files missing
Required For: Push notifications and Google Sign-In

Setup Steps:

A. Firebase Console:

Use same Firebase project from Phase 1.3
Add iOS app with bundle ID pl.szybkafucha.mobile
Download GoogleService-Info.plist
Add Android app with package name pl.szybkafucha.mobile
Download google-services.json
Enable Cloud Messaging for both platforms
B. iOS Setup:

Copy GoogleService-Info.plist to mobile/ios/Runner/
Open Xcode and add file to Runner target
Enable Push Notifications capability
C. Android Setup:

Copy google-services.json to mobile/android/app/
Add Firebase messaging dependency (if not present)
Reference: Mobile docs mobile/docs/PRODUCTION_AUTH_SETUP.md lines 1-100
PRD Reference: Section 4.5 Real-time Module (push notifications)

2.6 Android Release Signing
Status: Using debug keystore
Required For: Google Play Store release

Setup Steps:

A. Generate Release Keystore:


cd mobile/android
keytool -genkey -v -keystore release-keystore.jks -keyalg RSA -keysize 2048 -validity 10000 -alias szybkafucha
B. Create mobile/android/key.properties:


storePassword=<YOUR_KEYSTORE_PASSWORD>
keyPassword=<YOUR_KEY_PASSWORD>
keyAlias=szybkafucha
storeFile=release-keystore.jks
C. Update mobile/android/app/build.gradle.kts:


// Add before android block
def keystoreProperties = new Properties()
def keystorePropertiesFile = rootProject.file('key.properties')
if (keystorePropertiesFile.exists()) {
    keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
}

android {
    signingConfigs {
        release {
            keyAlias keystoreProperties['keyAlias']
            keyPassword keystoreProperties['keyPassword']
            storeFile keystoreProperties['storeFile'] ? file(keystoreProperties['storeFile']) : null
            storePassword keystoreProperties['storePassword']
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
        }
    }
}
D. Secure Storage:

Add key.properties to .gitignore
Store keystore file securely (DO NOT commit to git)
Back up keystore file (losing it = unable to update app)
Reference: Mobile file android/app/build.gradle.kts lines 30-36
PRD Reference: Section 6.1 Design System (mobile deployment)

2.7 Google Maps API Keys (Optional for MVP)
Status: Using placeholder grid pattern
Required For: Real-time location map display

Setup Steps:

A. Google Cloud Console:

Enable Maps SDK for Android
Enable Maps SDK for iOS
Create API key with restrictions
Note: Costs money after free tier
B. Android Configuration:

Edit mobile/android/app/src/main/AndroidManifest.xml:

<application>
  <meta-data
    android:name="com.google.android.geo.API_KEY"
    android:value="YOUR_ANDROID_API_KEY"/>
</application>
C. iOS Configuration:

Edit mobile/ios/Runner/AppDelegate.swift:

import GoogleMaps

GMSServices.provideAPIKey("YOUR_IOS_API_KEY")
Alternative: Launch MVP with grid pattern placeholder, add maps post-launch
Reference: Mobile file lib/features/client/widgets/contractor_location_map.dart
PRD Reference: Section 5.1 Tech Stack (Google Maps API)

Phase 3: Backend Production Hardening (Important)
3.1 CORS Configuration
Status: Allows all origins in WebSocket gateway
Required For: Security

Setup Steps:

Edit backend/src/realtime/realtime.gateway.ts line 75:

cors: {
  origin: ['https://szybkafucha.pl', 'https://admin.szybkafucha.pl'],
  credentials: true,
}
Update main CORS config in src/main.ts if needed
Reference: Backend file src/realtime/realtime.gateway.ts line 75
PRD Reference: Security best practices

3.2 Disable TypeORM Synchronization
Status: Enabled for development (auto-creates tables)
Required For: Production safety

Setup Steps:

Edit backend/src/app.module.ts:

TypeOrmModule.forRoot({
  // ... other config
  synchronize: false, // CRITICAL: Must be false in production
})
Ensure migrations are ready before deployment
Reference: Backend file src/app.module.ts TypeORM configuration
PRD Reference: Section 5.3 Database Schema

3.3 Environment-Specific Configuration
Status: Single .env file for all environments
Required For: Secure deployment

Setup Steps:

Create separate environment files:
.env.development
.env.staging
.env.production
Use environment variable to select config:

NODE_ENV=production npm start
Never commit production secrets to git
Reference: Backend file .env, DEPLOYMENT.md
PRD Reference: Section 8.1 Launch Criteria

Phase 4: Testing & Validation (Critical)
4.1 Backend Integration Testing
Status: Unit tests exist (65+ tests), needs runtime testing
Required For: Production confidence

Test Checklist:

 Test phone OTP with real Twilio account
 Test Google OAuth token validation
 Test Apple Sign-In token validation
 Test Stripe payment creation and capture
 Test Stripe webhook events
 Test Firebase push notification delivery
 Test WebSocket connection with JWT
 Test location tracking events
 Test chat message delivery
 Test task status updates via WebSocket
How to Test:

Start backend with production-like environment
Use Postman or mobile app to test each endpoint
Follow manual test guide: backend/TEST_RESULTS.md
Reference: Backend tests in test/ directory, TEST_RESULTS.md
PRD Reference: Section 8.1 Launch Criteria, Task 19.0 in tasks-prd

4.2 Mobile End-to-End Testing
Status: No automated tests, manual testing only
Required For: User flow validation

Test Checklist:

 Test registration via phone OTP
 Test registration via Google Sign-In
 Test registration via Apple Sign-In
 Test task creation flow (all 6 categories)
 Test contractor selection
 Test payment flow with real Stripe test card
 Test task tracking with WebSocket connection
 Test real-time chat
 Test task completion and rating
 Test contractor verification flow
 Test earnings and withdrawal
How to Test:

Build release version of app
Test on real iOS and Android devices
Use Stripe test cards for payment testing
Follow manual test guide: mobile/docs/TESTING_GUIDE.md
Reference: Mobile docs mobile/docs/TESTING_GUIDE.md
PRD Reference: Section 8.1 Launch Criteria, Tasks 19.1-19.5

4.3 Load Testing
Status: Not performed
Required For: Performance validation

Test Plan:

Use tools like k6, Artillery, or JMeter
Test with 100+ concurrent users
Focus on:
Task creation rate
WebSocket connections
Payment processing
Database queries
Reference: No current documentation
PRD Reference: Task 19.6 in tasks-prd

Phase 5: App Store Preparation (Important)
5.1 iOS App Store
Status: Basic assets present, no store listing
Required For: iOS launch

Checklist:

 App icons (all sizes) - ✅ Present
 Launch screen - ✅ Present
 Screenshots (6.7", 6.5", 5.5" displays)
 App preview video (optional but recommended)
 App Store description (Polish)
 Keywords for search optimization
 Privacy policy URL: https://szybkafucha.pl/privacy.html
 Terms of service URL: https://szybkafucha.pl/terms.html
 Support URL: Contact email or website
 TestFlight beta testing
 App Review submission
Reference: Mobile assets in ios/Runner/Assets.xcassets/
PRD Reference: Task 20.0 in tasks-prd

5.2 Google Play Store
Status: Basic assets present, no store listing
Required For: Android launch

Checklist:

 App icons (all densities) - ✅ Present
 Screenshots (phone and tablet)
 Feature graphic (1024x500)
 Short description (80 chars max)
 Full description (4000 chars max, Polish)
 Privacy policy URL: https://szybkafucha.pl/privacy.html
 Terms of service URL: https://szybkafucha.pl/terms.html
 Content rating questionnaire
 Beta testing track
 Production release
Reference: Mobile assets in android/app/src/main/res/
PRD Reference: Task 20.0 in tasks-prd

Phase 6: Infrastructure & Deployment (Critical)
6.1 Backend Deployment
Status: Documentation exists, needs execution
Required For: Production API

Deployment Options:

Option A: AWS ECS (Recommended in PRD)

Elastic Container Service for backend
RDS for PostgreSQL with PostGIS
ElastiCache for Redis
Application Load Balancer
Auto-scaling enabled
Option B: Simpler Alternatives

Heroku with PostgreSQL and Redis add-ons
DigitalOcean App Platform
Railway.app
Render.com
Setup Steps:

Choose deployment platform
Configure environment variables
Set up SSL certificate (Let's Encrypt)
Configure domain: api.szybkafucha.pl
Deploy backend
Test health check endpoint: /health
Monitor logs and errors
Reference: Backend file DEPLOYMENT.md (413 lines)
PRD Reference: Section 5.1 System Overview, Task 21.0 in tasks-prd

6.2 Database Migrations
Status: TypeORM synchronization enabled (unsafe for production)
Required For: Database schema management

Setup Steps:

Disable synchronization (see Phase 3.2)
Create initial migration if needed:

npm run migration:generate -- -n InitialSchema
Review generated migration file
Test migration on staging database
Run migration on production:

npm run migration:run
Reference: Backend docs tasks/DATABASE_MIGRATIONS.md
PRD Reference: Section 5.3 Database Schema

6.3 Monitoring & Logging
Status: Not configured
Required For: Production support

Recommended Services:

Error tracking: Sentry (frontend + backend)
Performance monitoring: New Relic or DataDog
Uptime monitoring: Pingdom or UptimeRobot
Log aggregation: CloudWatch Logs or Loggly
Setup Priority:

Sentry for error tracking (CRITICAL)
Basic uptime monitoring (IMPORTANT)
Performance monitoring (NICE TO HAVE)
Reference: Backend docs tasks/PRODUCTION_SETUP.md mentions monitoring
PRD Reference: Task 21.3 in tasks-prd

6.4 Admin Dashboard Deployment
Status: React app ready, needs hosting
Required For: Admin operations

Deployment Options:

Vercel (recommended, free for small projects)
Netlify
AWS S3 + CloudFront
Same server as backend (nginx static files)
Setup Steps:

Build admin dashboard: npm run build
Configure API endpoint to production backend
Deploy static files
Configure domain: admin.szybkafucha.pl
Set up SSL certificate
Reference: Admin directory admin/ with React app
PRD Reference: Task 18.0 in tasks-prd, Task 21.6

Phase 7: Post-Launch Monitoring (Important)
7.1 Soft Launch Checklist
Status: Not started
Required For: Gradual rollout

Steps:

Launch to limited users (50-100 first week)
Monitor error rates in Sentry
Check WebSocket connection stability
Verify payment processing success rate
Monitor SMS delivery rates
Track app crashes and ANRs
Collect user feedback
Fix critical bugs immediately
Gradual expansion to more users
Reference: No current documentation
PRD Reference: Task 22.0 in tasks-prd, Section 8.1 Launch Criteria

Summary: Must-Have vs Nice-to-Have
MUST HAVE (MVP Won't Function Without These):
Backend:
✅ Twilio SMS - Phone authentication
✅ Stripe - Payment processing
✅ JWT Secret - Strong random secret
✅ Database - Production PostgreSQL
✅ Redis - OTP and session storage
✅ CORS - Restrict origins
✅ Disable synchronization - Database safety
Mobile:
✅ API URL - Change from localhost
✅ WebSocket URL - Change from localhost
✅ Disable dev mode - In both config files
✅ Google Sign-In - Client IDs and google-services files
✅ Apple Sign-In - Developer account setup
✅ Android signing - Release keystore
Testing:
✅ Backend integration tests - With real services
✅ Mobile E2E tests - Complete user flows
✅ Payment testing - Stripe test mode
Deployment:
✅ Backend hosting - Production server
✅ SSL certificates - HTTPS/WSS
✅ Domain configuration - api.szybkafucha.pl
NICE TO HAVE (Can Launch Without, Add Later):
⏳ Firebase Push Notifications - Use in-app only initially
⏳ Onfido KYC - Manual verification via admin dashboard
⏳ Google Maps - Use placeholder grid pattern
⏳ Load testing - Monitor and scale as needed
⏳ Monitoring (Sentry) - Add after initial stability
⏳ Admin dashboard - Can use backend API directly initially
Estimated Timeline
Phase 1-2 (Backend + Mobile Config): 2-3 days
Phase 3 (Backend Hardening): 1 day
Phase 4 (Testing): 2-3 days
Phase 5 (App Store): 1-2 days
Phase 6 (Deployment): 1-2 days
Phase 7 (Monitoring): Ongoing

Total: 7-11 days for MVP production launch

Quick Reference Links
Backend:

Configuration: backend/.env
Deployment guide: backend/DEPLOYMENT.md
Test results: backend/TEST_RESULTS.md
Mobile:

API config: mobile/lib/core/api/api_config.dart
WebSocket config: mobile/lib/core/config/websocket_config.dart
Auth setup guide: mobile/docs/PRODUCTION_AUTH_SETUP.md
Testing guide: mobile/docs/TESTING_GUIDE.md
PRD Documents:

Main PRD: tasks/prd-szybka-fucha.md
Task breakdown: tasks/tasks-prd-szybka-fucha.md
Production Docs:

Backend fixes: tasks/BACKEND_CRITICAL_FIXES.md
Production setup: tasks/PRODUCTION_SETUP.md
Production checklist: tasks/PRODUCTION_CHECKLIST.md
Next Steps
Review this document with technical team
Prioritize tasks based on launch timeline
Set up external services (Phase 1) - Start ASAP
Configure mobile app (Phase 2) - Parallel with Phase 1
Test integration (Phase 4) - As services become available
Prepare app stores (Phase 5) - During testing phase
Deploy infrastructure (Phase 6) - Final week before launch
Soft launch (Phase 7) - Limited user rollout
Document Version: 1.0
Last Updated: 2026-01-19
Status: Ready for implementation

User approved the plan
This session is being continued from a previous conversation that ran out of context. The summary below covers the earlier portion of the conversation.

Analysis:
Let me analyze this conversation chronologically to ensure I capture all essential details:

1. **Initial Context (System Message)**: User indicated this session continues from a previous conversation. A comprehensive summary was provided showing:
   - Task 16.0 (Contractor Screens) was completed
   - Task 17.0 (Real-time Features) planning was in progress
   - Multiple files created for WebSocket, location tracking, and chat features
   - ~2,850 lines of new code across 15 files
   - Dev mode implementation for testing without backend

2. **User's Explicit Request**: The user asked three specific things:
   - "For fully functional MVP what must be done?"
   - "Create a list of tasks and guide step by step after analysing the @tasks/tasks-prd-szybka-fucha.md and @tasks/prd-szybka-fucha.md"
   - "I need to be able to test this with backend not using developer mode"
   - Specific examples needed: "For example for chat integration or Notification or google sign in or for phone number verification"
   - "If the requirement are in the documentation please add the reference to the new document It_must_be_done_before_MVP_start.MD"

3. **My Approach**:
   - Launched 3 Explore agents in parallel to analyze:
     - Agent 1: Backend external service integrations and configuration requirements
     - Agent 2: Mobile app production configuration and what needs to change
     - Agent 3: Testing status, deployment readiness, and known issues
   - Created comprehensive plan document at `/Users/simacbook/.claude/plans/serialized-doodling-flame.md`

4. **Agent Results Analysis**:
   - **Agent 1 (Backend)**: Found all external services are in mock mode:
     - Twilio SMS (fixed OTP `123456`)
     - Stripe (mock payment intents)
     - Firebase (logs to console)
     - Onfido (auto-approves after 5 seconds)
     - JWT using weak secret
     - Database and Redis configured for localhost
   
   - **Agent 2 (Mobile)**: Identified all production configuration gaps:
     - API URL hardcoded to `localhost:3000`
     - WebSocket URL hardcoded to `ws://localhost:3000`
     - Dev mode enabled in both config files
     - Google Sign-In missing client IDs and firebase config files
     - Apple Sign-In needs Developer Portal setup
     - Android signing using debug keystore
     - Firebase config files missing
     - Google Maps not configured (using grid placeholder)
   
   - **Agent 3 (Testing/Deployment)**: Found:
     - Backend: 95/100 readiness, 65+ unit tests, comprehensive deployment docs
     - Mobile: 60/100 readiness, no automated tests, missing deployment docs
     - Landing page: 85/100, needs final polish
     - Overall: Backend code-ready, needs external service credentials; Mobile needs config changes and testing

5. **Deliverable Created**: 
   - Created comprehensive 789-line production readiness plan
   - Organized into 7 phases: Backend Setup, Mobile Config, Backend Hardening, Testing, App Store, Deployment, Monitoring
   - Each phase includes specific steps, file references, environment variables, and PRD references
   - Estimated timeline: 7-11 days for MVP launch
   - Marked as "Ready for implementation"

6. **Plan Content Details**:
   - Phase 1 (7 sections): Twilio, Stripe, Firebase, Onfido, JWT, Database, Redis
   - Phase 2 (7 sections): API URL, WebSocket, Google Sign-In, Apple Sign-In, Firebase Mobile, Android Signing, Google Maps
   - Phase 3 (3 sections): CORS, TypeORM Synchronization, Environment-Specific Config
   - Phase 4 (3 sections): Backend Testing, Mobile E2E Testing, Load Testing
   - Phase 5 (2 sections): iOS App Store, Google Play Store
   - Phase 6 (4 sections): Backend Deployment, Database Migrations, Monitoring, Admin Dashboard
   - Phase 7 (1 section): Soft Launch Checklist

7. **Key Technical Details from Agents**:
   - Backend files with exact line numbers for each configuration point
   - Mobile files with exact line numbers and code examples
   - Environment variable templates for all services
   - Step-by-step setup instructions for each external service
   - Must-have vs nice-to-have differentiation
   - References to existing PRD sections and backend documentation

8. **User Feedback**: 
   - No explicit feedback on the plan was given
   - User approved the plan via ExitPlanMode system message
   - Plan was marked as saved to `/Users/simacbook/.claude/plans/serialized-doodling-flame.md`

9. **Current State**:
   - Plan mode exited
   - Plan document is finalized and approved
   - No code changes were made (plan phase only)
   - No pending implementation work was started
   - System indicated user can now "start coding" and to "update your todo list if applicable"

10. **Remaining Context**:
   - The conversation came from a previous session where Task 17.0 (Real-time Features) was fully implemented with:
     - WebSocket service with dev mode mock
     - Location tracking providers
     - Chat feature with offline queuing
     - Message model with status tracking
     - All integrated with app router
     - ~2,850 lines of code created
   - Task 17.0 completion documentation was created
   - Task 16.0 was marked complete
   - PRD documents were analyzed to create production readiness plan

Summary:
## 1. Primary Request and Intent

The user requested a comprehensive guide for preparing the Szybka Fucha MVP for production launch with backend integration (no developer mode). Specifically, the user asked:

1. **"For fully functional MVP what must be done?"** - Create a complete checklist of all tasks required
2. **"Create a list of tasks and guide step by step after analysing the @tasks/tasks-prd-szybka-fucha.md and @tasks/prd-szybka-fucha.md"** - Analyze both PRD documents and provide structured guidance
3. **"I need to be able to test this with backend not using developer mode"** - Ensure testing can be done against real production backend services
4. **"For example for chat integration or Notification or google sign in or for phone number verification"** - Provide specific examples of each critical flow
5. **"If the requirement are in the documentation please add the reference to the new document It_must_be_done_before_MVP_start.MD"** - Reference both PRD requirements and create a new document with all prerequisites

The user wanted a single, comprehensive document that clearly delineates what must be done before MVP launch, with explicit references to where requirements are documented in the PRDs.

---

## 2. Key Technical Concepts

- **Socket.io WebSocket Communication**: Real-time bidirectional communication for chat and location tracking (namespace: `/realtime` with JWT authentication)
- **Riverpod State Management**: Type-safe reactive state with `StreamProvider` for real-time events
- **Mock Mode Pattern**: Graceful fallback implementation allowing dev mode testing without external services
- **OAuth 2.0 Integration**: Google Sign-In and Apple Sign-In with platform-specific configuration
- **Stripe Connect**: Marketplace payment processing with escrow and contractor account creation
- **Firebase Cloud Messaging**: Push notifications with service account authentication
- **Onfido KYC**: Identity verification with document upload and facial recognition
- **Twilio SMS**: OTP delivery for phone-based authentication
- **PostgreSQL with PostGIS**: Geographic data storage and querying for contractor matching
- **Redis**: Session storage, OTP caching, and rate limiting
- **JWT (JSON Web Tokens)**: Stateless authentication with 30-day expiration
- **Material 3 Design System**: Flutter UI framework with Polish localization
- **Go Router**: Type-safe navigation with auth guards and deep linking
- **TypeORM**: Database ORM with auto-synchronization (must be disabled for production)
- **NestJS**: Backend framework with module-based architecture
- **Exponential Backoff**: Reconnection strategy for WebSocket reliability (1s → 2s → 4s → 8s max)
- **Offline Message Queuing**: Local persistence and auto-retry of unsent messages
- **Haversine Formula**: Geographic distance calculation for contractor matching
- **Geolocator**: GPS polling for real-time location tracking (15-second interval)

---

## 3. Files and Code Sections

### Backend Configuration Files:
- **`backend/.env`**
  - Current state: Uses development localhost addresses and placeholder credentials
  - Critical for production: Must contain real credentials for Twilio, Stripe, Firebase, Onfido, JWT secret
  - Environment variables required: DATABASE_HOST, DATABASE_PASSWORD, REDIS_PASSWORD, TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_PHONE_NUMBER, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, FIREBASE_PROJECT_ID, FIREBASE_CLIENT_EMAIL, FIREBASE_PRIVATE_KEY, ONFIDO_API_TOKEN, JWT_SECRET

- **`backend/src/auth/auth.service.ts`** (lines 37-48, 253-272)
  - Current implementation: Mock mode detects missing Twilio credentials and falls back to fixed OTP `123456`
  - Production requirement: Must be configured with real Twilio account details
  - Real implementation: Sends actual SMS via Twilio API

- **`backend/src/payments/payments.service.ts`** (lines 41-48)
  - Current implementation: Mock mode returns fake payment intents
  - Production requirement: Must use real Stripe Secret Key and configure webhook endpoint
  - Implements 17% platform fee with 83% contractor earnings

- **`backend/src/notifications/notifications.service.ts`** (lines 33-44)
  - Current implementation: Mock mode logs notifications to console instead of sending
  - Production requirement: Must have Firebase service account credentials configured
  - Handles 12+ notification types (task status, payments, messages, KYC updates)

- **`backend/src/kyc/kyc.service.ts`** (lines 62-79)
  - Current implementation: Mock mode auto-approves verification after 5-second delay
  - Production requirement: Must have Onfido API token or implement manual admin verification
  - Alternative: Launch MVP with manual verification via admin dashboard

- **`backend/src/app.module.ts`** (database and cache configuration)
  - Critical production change: Disable TypeORM synchronization (`synchronize: false`)
  - Currently set to `synchronize: true` for auto-table creation in development
  - Must set up migrations before disabling synchronization

- **`backend/src/realtime/realtime.gateway.ts`** (line 75)
  - Current CORS: `origin: '*'` allows all origins
  - Production requirement: Restrict to specific domains like `['https://szybkafucha.pl', 'https://admin.szybkafucha.pl']`

### Mobile Configuration Files:

- **`mobile/lib/core/api/api_config.dart`** (lines 5, 17)
  - Current state: `devModeEnabled = true` and `baseUrl = 'http://localhost:3000/api/v1'`
  - Production requirement: Change to `devModeEnabled = false` and `baseUrl = 'https://api.szybkafucha.pl/api/v1'`
  - Controls all API endpoint routing

- **`mobile/lib/core/config/websocket_config.dart`** (lines 9, 52)
  - Current state: `webSocketUrl = 'ws://localhost:3000'` and `devModeEnabled = true`
  - Production requirement: Change to `webSocketUrl = 'wss://api.szybkafucha.pl'` and `devModeEnabled = false`
  - Implementation details:
    ```dart
    static const String webSocketUrl = 'wss://api.szybkafucha.pl';
    static const String namespace = '/realtime';
    static const bool devModeEnabled = false;
    ```

- **`mobile/lib/core/services/websocket_service.dart`** (~380 lines)
  - Singleton service managing Socket.io connections
  - Implements automatic reconnection with exponential backoff
  - Handles location updates, chat messages, task status events
  - When `devModeEnabled = true`: Simulates location updates every 15 seconds and incoming messages after 5-second delay
  - When `devModeEnabled = false`: Uses real WebSocket connection to backend

- **`mobile/lib/core/providers/websocket_provider.dart`** (~135 lines)
  - Riverpod providers for WebSocket state management
  - Providers: `webSocketServiceProvider`, `webSocketStateProvider`, `webSocketConnectedProvider`
  - Stream providers: `locationUpdatesProvider`, `chatMessagesProvider`, `taskStatusUpdatesProvider`, `userPresenceProvider`
  - Mock JWT token in dev mode: `'mock_jwt_token_for_development'` (line 129)

- **`mobile/lib/features/contractor/providers/location_provider.dart`** (~165 lines)
  - Contractor location broadcasting (GPS polling every 15 seconds)
  - State tracking: `isTracking`, `currentLatitude`, `currentLongitude`, `lastUpdateTime`
  - Mock location simulation in dev mode with small random movements

- **`mobile/lib/features/client/providers/contractor_location_provider.dart`** (~210 lines)
  - Client-side location receiving and tracking
  - Haversine formula for distance calculation
  - ETA estimation assuming ~30 km/h average urban speed
  - Task room join/leave management

- **`mobile/lib/features/client/widgets/contractor_location_map.dart`** (~420 lines)
  - Visual display of real-time contractor location
  - Currently uses grid pattern placeholder (no actual maps integration)
  - Shows distance in km, ETA in minutes, connection status
  - Can be extended with google_maps_flutter for production

- **`mobile/lib/features/chat/models/message.dart`** (~140 lines)
  - Message model with equatable for equality comparison
  - Message status enum: `pending`, `sent`, `delivered`, `read`, `failed`
  - JSON serialization for local storage
  - Mock conversation factory method with realistic Polish text

- **`mobile/lib/features/chat/providers/chat_provider.dart`** (~240 lines)
  - `ChatNotifier` extends StateNotifier for real-time chat state management
  - `ChatState` tracks: messages, pendingMessages, isConnected, error
  - Methods: `sendMessage()`, `markAllAsRead()`, `loadInitialMessages()`, `retrySendingPending()`
  - Offline message queuing with automatic retry on reconnection
  - Mock implementation loads predefined conversation from `Message.mockConversation()`

- **`mobile/lib/features/chat/screens/chat_screen.dart`** (~180 lines)
  - Full chat UI with message list and input field
  - Features: Auto-scroll to new messages, connection indicator, error banner, empty state
  - Uses `ChatScreen(taskId, taskTitle, otherUserName, currentUserId, currentUserName)`
  - Replaces deprecated `WillPopScope` with `PopScope` (PopScope with `onPopInvoked`)

- **`mobile/lib/features/chat/widgets/message_bubble.dart`** (~180 lines)
  - Individual message display with sender avatar, name, timestamp
  - Status icon indicating message delivery state
  - Bubble color: Coral red (#E94560) for current user, gray for other user
  - Smart timestamp formatting (HH:mm for today, "Wczoraj HH:mm" for yesterday)

- **`mobile/lib/features/chat/widgets/chat_input.dart`** (~180 lines)
  - Message input field with send button
  - Pending messages indicator banner
  - Loading spinner during send
  - Disabled state when offline or no text
  - Safe BuildContext usage with `mounted` check and `ignore: use_build_context_synchronously` comments

- **`mobile/ios/Runner/Info.plist`**
  - Missing production configuration for Google Sign-In
  - Required additions for production:
    ```xml
    <key>CFBundleURLTypes</key>
    <array>
      <dict>
        <key>CFBundleURLSchemes</key>
        <array>
          <string>com.googleusercontent.apps.YOUR_IOS_CLIENT_ID</string>
        </array>
      </dict>
    </array>
    <key>GIDClientID</key>
    <string>YOUR_IOS_CLIENT_ID.apps.googleusercontent.com</string>
    ```

- **`mobile/android/app/build.gradle.kts`** (lines 30-36)
  - Currently signing release builds with debug keystore (TODO comment indicates this)
  - Must implement proper release signing with keystore and key.properties file
  - Required structure for production:
    ```kotlin
    def keystoreProperties = new Properties()
    def keystorePropertiesFile = rootProject.file('key.properties')
    if (keystorePropertiesFile.exists()) {
        keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
    }
    
    android {
        signingConfigs {
            release {
                keyAlias keystoreProperties['keyAlias']
                keyPassword keystoreProperties['keyPassword']
                storeFile keystoreProperties['storeFile'] ? file(keystoreProperties['storeFile']) : null
                storePassword keystoreProperties['storePassword']
            }
        }
        buildTypes {
            release {
                signingConfig signingConfigs.release
            }
        }
    }
    ```

- **`mobile/android/key.properties`** (needs to be created)
  - Contains keystore credentials for release signing
  - Must be added to `.gitignore` (DO NOT commit to git)
  - Format:
    ```properties
    storePassword=<YOUR_KEYSTORE_PASSWORD>
    keyPassword=<YOUR_KEY_PASSWORD>
    keyAlias=szybkafucha
    storeFile=release-keystore.jks
    ```

### Missing Mobile Configuration Files (must be created/added):

- **`mobile/android/app/google-services.json`**
  - Downloaded from Firebase Console after adding Android app
  - Contains Firebase project configuration for Android platform
  - Enables Google Sign-In and Cloud Messaging

- **`mobile/ios/Runner/GoogleService-Info.plist`**
  - Downloaded from Firebase Console after adding iOS app
  - Contains Firebase project configuration for iOS platform
  - Must be added to Xcode Runner target

### Documentation Files Created:

- **`/Users/simacbook/.claude/plans/serialized-doodling-flame.md`** (789 lines)
  - Comprehensive MVP production readiness plan
  - Organized into 7 phases with 23 detailed sections
  - Each section includes: Status, Required For, Setup Steps, References
  - Contains environment variable templates for all external services
  - Includes implementation timeline: 7-11 days for MVP launch
  - PRD cross-references to tasks-prd-szybka-fucha.md and prd-szybka-fucha.md

### Referenced Documentation:

- **`backend/DEPLOYMENT.md`** (413 lines)
  - Step-by-step backend deployment instructions
  - Nginx reverse proxy configuration
  - Health check verification procedures

- **`backend/TEST_RESULTS.md`** (381 lines)
  - Security fixes validation results
  - Manual test checklist with 8 comprehensive tests
  - Backend readiness score: 95/100

- **`mobile/docs/PRODUCTION_AUTH_SETUP.md`** (1385 lines)
  - Production authentication setup guide
  - Covers Google Sign-In and Apple Sign-In configuration
  - Firebase setup procedures

- **`mobile/docs/TESTING_GUIDE.md`**
  - Manual testing procedures with mock users
  - Dev mode enabled for UI testing without backend
  - Test scenarios documented

- **`tasks/BACKEND_CRITICAL_FIXES.md`** (648 lines)
  - 8 critical security fixes (all implemented)
  - CORS security, rate limiting, exception handling

- **`tasks/PRODUCTION_SETUP.md`** (242 lines)
  - Production environment configuration
  - HTTPS/SSL setup, rate limiting, database backup procedures

- **`tasks/PRODUCTION_CHECKLIST.md`** (462 lines)
  - Overall production readiness checklist
  - Landing page, backend, mobile, infrastructure status

---

## 4. Errors and Fixes

### No Direct Errors in This Session

This session was focused on **planning phase only** - no code was written or executed, so no compilation or runtime errors occurred. The exploration agents analyzed existing code and configuration without modifications.

However, the exploration identified **configuration gaps** that are "errors" in the sense of being non-production-ready states:

1. **Hardcoded Dev URLs**: 
   - Both API and WebSocket URLs hardcoded to `localhost:3000`
   - Impact: Mobile app cannot connect to production backend
   - Fix: Change both URLs and disable dev mode flags

2. **Dev Mode Enabled by Default**:
   - `devModeEnabled = true` in both `api_config.dart` and `websocket_config.dart`
   - Impact: App uses mock data and simulated services instead of real backend
   - Fix: Set both flags to `false` for production

3. **Missing External Service Credentials**:
   - Twilio: Placeholder account (uses fixed OTP `123456`)
   - Stripe: Mock payment intents returned
   - Firebase: Logs notifications to console instead of sending
   - Onfido: Auto-approves KYC after 5 seconds
   - Impact: Core functionality (payments, SMS, notifications) won't work
   - Fix: Set up real accounts and add credentials to `.env`

4. **TypeORM Synchronization Enabled**:
   - Database table creation is automatic in development
   - Impact: Production safety risk, data loss possible during migrations
   - Fix: Set `synchronize: false` in `app.module.ts` before production deployment

5. **Firebase Config Files Missing**:
   - `google-services.json` not in `mobile/android/app/`
   - `GoogleService-Info.plist` not in `mobile/ios/Runner/`
   - Impact: Firebase features (FCM, Google Sign-In) won't work on mobile
   - Fix: Download from Firebase Console and add to project

6. **Android Release Signing Missing**:
   - Release builds use debug keystore
   - TODO comment indicates incomplete implementation
   - Impact: Cannot publish to Google Play Store
   - Fix: Generate release keystore and configure in `build.gradle.kts`

**User Feedback**: None explicit - the user approved the plan without requesting changes

---

## 5. Problem Solving

### Problem 1: Determining Production Readiness Requirements
**Issue**: User asked for MVP production readiness checklist without clear understanding of what's missing

**Solution**: Launched 3 parallel exploration agents to comprehensively analyze:
- Backend external services and configuration state
- Mobile app configuration gaps and platform-specific requirements
- Testing coverage and deployment documentation status

**Result**: Created detailed 789-line plan document that clearly identifies:
- What is currently in mock/dev mode
- What external service credentials must be obtained
- What code configuration changes must be made
- Step-by-step setup procedures for each component
- References to PRD requirements for each task

### Problem 2: Organizing Disparate Information Across Multiple Systems
**Issue**: Requirements scattered across:
- PRD documents (`prd-szybka-fucha.md`, `tasks-prd-szybka-fucha.md`)
- Existing backend documentation (`DEPLOYMENT.md`, `TEST_RESULTS.md`)
- Mobile documentation (`PRODUCTION_AUTH_SETUP.md`, `TESTING_GUIDE.md`)
- Code configuration scattered across multiple files

**Solution**: Created unified document (`MVP_Production_Readiness_Plan.md`) with:
- Cross-referenced sections to PRD requirements
- Explicit file paths and line numbers for every configuration point
- Environment variable templates
- Step-by-step setup procedures

**Result**: Single source of truth for MVP launch preparation with full traceability to PRD

### Problem 3: Distinguishing Must-Have from Nice-to-Have for Launch
**Issue**: 23 different configuration and setup tasks - unclear which are blockers vs. post-launch additions

**Solution**: Categorized all tasks as:
- **MUST HAVE** (7 backend, 6 mobile, 3 testing, 3 deployment - 19 total)
- **NICE TO HAVE** (6 items: Firebase, Onfido, Maps, Load Testing, Monitoring, Admin Dashboard)

**Result**: Clear path to MVP launch in 7-11 days with ability to add non-critical features post-launch

### Ongoing Issue: No Backend Service Credentials
This is not a problem I can solve - it requires user action to:
1. Create accounts with Twilio, Stripe, Firebase, Onfido
2. Obtain credentials for each service
3. Configure webhook endpoints
4. Test real-world integrations

The plan document provides exact step-by-step instructions for each service.

---

## 6. All User Messages

1. **"For fully functional MVP what must be done? Create a list of tasks and guide step by step after analysing the @tasks/tasks-prd-szybka-fucha.md and @tasks/prd-szybka-fucha.md I need to be able to test this with backend not using developer mode What i need to do ? For example for chat inegration or Notification or google sign in or for phone number verification. If the reuirment are in the documentation please add the reference to the new document It_must_be_done_before_MVP_start.MD"**
   - This is the primary request that drove the entire analysis
   - Asked for comprehensive list of MVP prerequisites
   - Specified focus on backend testing (no dev mode)
   - Requested specific examples of critical integrations
   - Wanted references to PRD documentation
   - Implicitly requested creation of a new document: `It_must_be_done_before_MVP_start.MD`

2. **[No subsequent user messages - system message approved plan via ExitPlanMode]**

---

## 7. Pending Tasks

Based on the approved plan document, the following tasks must be completed before MVP launch:

### Phase 1: Backend External Service Setup (Critical - 2-3 days)
1. Set up Twilio SMS account and obtain: ACCOUNT_SID, AUTH_TOKEN, PHONE_NUMBER
2. Set up Stripe account and configure Stripe Connect for contractor accounts
3. Create Firebase project and obtain: PROJECT_ID, CLIENT_EMAIL, PRIVATE_KEY
4. Set up Onfido account (optional: can use manual admin verification)
5. Generate strong JWT_SECRET using `openssl rand -base64 48`
6. Provision PostgreSQL 15+ database with PostGIS extension
7. Provision Redis 7+ instance with password authentication

### Phase 2: Mobile App Production Configuration (Critical - 1-2 days)
1. Edit `mobile/lib/core/api/api_config.dart`:
   - Set `devModeEnabled = false`
   - Change `baseUrl` to `https://api.szybkafucha.pl/api/v1`
2. Edit `mobile/lib/core/config/websocket_config.dart`:
   - Set `devModeEnabled = false`
   - Change `webSocketUrl` to `wss://api.szybkafucha.pl`
3. Configure Google Sign-In:
   - Create Google Cloud project and OAuth credentials
   - Add iOS configuration to `Info.plist`
   - Add `google-services.json` to Android
4. Configure Apple Sign-In in Apple Developer Portal
5. Add Firebase configuration files:
   - Download and add `google-services.json` to `mobile/android/app/`
   - Download and add `GoogleService-Info.plist` to `mobile/ios/Runner/`
6. Set up Android release signing:
   - Generate release keystore
   - Create `mobile/android/key.properties`
   - Update `build.gradle.kts` with signing configuration

### Phase 3: Backend Production Hardening (Important - 1 day)
1. Update CORS configuration in `realtime.gateway.ts` to restrict origins
2. Disable TypeORM synchronization in `app.module.ts` (`synchronize: false`)
3. Create environment-specific configuration (`.env.development`, `.env.staging`, `.env.production`)

### Phase 4: Testing & Validation (Critical - 2-3 days)
1. Backend integration testing:
   - Test Twilio SMS delivery with real phone number
   - Test Stripe payment creation and capture
   - Test Firebase push notification delivery
   - Test WebSocket location updates and chat
2. Mobile E2E testing:
   - Test phone OTP registration
   - Test Google and Apple Sign-In flows
   - Test complete task creation workflow
   - Test payment with Stripe test cards
   - Test real-time chat and location tracking
3. Load testing with 100+ concurrent users

### Phase 5: App Store Preparation (Important - 1-2 days)
1. Create iOS App Store listing (screenshots, description, keywords)
2. Create Google Play Store listing (screenshots, feature graphics, descriptions)
3. Configure TestFlight beta testing for iOS

### Phase 6: Infrastructure & Deployment (Critical - 1-2 days)
1. Choose deployment platform (AWS ECS recommended, or Heroku/Railway/DigitalOcean alternatives)
2. Deploy backend with production environment variables
3. Run database migrations
4. Set up SSL certificates (Let's Encrypt)
5. Configure domain: `api.szybkafucha.pl`
6. Deploy admin dashboard to `admin.szybkafucha.pl`
7. Set up error tracking (Sentry minimum)

### Phase 7: Post-Launch Monitoring (Ongoing)
1. Soft launch to 50-100 users first week
2. Monitor error rates, WebSocket stability, payment success
3. Gradual user expansion based on metrics

---

## 8. Current Work

**Status**: Plan Phase Complete - Awaiting User Direction

**What was accomplished**:
- Analyzed both PRD documents: `prd-szybka-fucha.md` and `tasks-prd-szybka-fucha.md`
- Launched 3 parallel exploration agents to comprehensively analyze:
  1. Backend external services configuration (Twilio, Stripe, Firebase, Onfido, JWT, Database, Redis)
  2. Mobile app production requirements (API/WebSocket URLs, OAuth, Firebase, Android signing, Google Maps)
  3. Testing status and deployment readiness (65+ backend tests, 0 mobile tests, comprehensive backend docs, missing mobile docs)
- Created comprehensive 789-line production readiness plan document at `/Users/simacbook/.claude/plans/serialized-doodling-flame.md`
- Organized plan into 7 phases with 23 detailed sections
- Categorized 23 tasks into Must-Have (19 tasks) vs Nice-to-Have (6 tasks)
- Provided estimated timeline: 7-11 days for MVP launch
- Included cross-references to PRD sections and existing documentation

**Key files analyzed but NOT modified**:
- `backend/.env` - identified all missing production credentials
- `backend/src/auth/auth.service.ts` - identified mock Twilio implementation
- `backend/src/payments/payments.service.ts` - identified mock Stripe implementation
- `backend/src/notifications/notifications.service.ts` - identified mock Firebase implementation
- `mobile/lib/core/api/api_config.dart` - identified hardcoded localhost URL
- `mobile/lib/core/config/websocket_config.dart` - identified hardcoded localhost WebSocket URL
- `mobile/android/app/build.gradle.kts` - identified incomplete release signing

**Session Result**:
- Plan approved via ExitPlanMode
- System message: "You have exited plan mode. You can now make edits, run tools, and take actions."
- Ready to begin implementation phase on user's next request

---

## 9. Optional Next Step

**Awaiting user direction.** The plan document is complete and approved. The user has not explicitly requested the next step. 

**Possible next steps based on the approved plan** (in priority order):
1. **Phase 1 Setup (Most Critical)**: Begin setting up external services (Twilio, Stripe, Firebase, JWT secret, Database, Redis). This can be parallelized and forms the foundation for all subsequent phases.
2. **Phase 2 Configuration (Critical)**: Modify mobile app configuration files to disable dev mode and point to production backend. This is fast (~1-2 hours) and unblocks mobile testing.
3. **Create Implementation Document**: User may want me to create the referenced document `It_must_be_done_before_MVP_start.MD` with more detailed instructions.

**However, I should await explicit user instruction before proceeding** with any of these tasks, as the user has not yet provided direction for the implementation phase.

If you need specific details from before compaction (like exact code snippets, error messages, or content you generated), read the full transcript at: /Users/simacbook/.claude/projects/-Users-simacbook-Development-projects-szybkafucha/c03025dc-0716-4426-97cf-5ce47c768d47.jsonl
Please continue the conversation from where we left it off without asking the user any further questions. Continue with the last task that you were asked to work on.
I'll continue from where we left off. Based on the conversation summary, you've approved the comprehensive MVP Production Readiness Plan. Now I need to create the document you requested: It_must_be_done_before_MVP_start.MD with all the prerequisites, examples, and PRD references.

Let me create this document with the detailed implementation guide you asked for:

Write It_must_be_done_before_MVP_start.MD
1328 lines
# IT MUST BE DONE BEFORE MVP START

**Document Status**: MVP Production Readiness Prerequisites
**Last Updated**: 2026-01-19
**Timeline**: 7-11 days to MVP launch
**Audience**: Development team, DevOps, Product

---

## Executive Summary

This document lists all tasks that **MUST** be completed before the Szybka Fucha MVP can launch with real backend integration (no developer mode). The MVP currently has ~95% backend code readiness and ~60% mobile code readiness, but is 0% production-ready due to missing external service configuration and mobile app hardening.

**Total Prerequisites**: 23 critical tasks organized in 6 phases
**Must-Have Tasks**: 19 (blockers for MVP launch)
**Nice-to-Have Tasks**: 6 (can be added post-launch)

---

## PHASE 1: BACKEND EXTERNAL SERVICE SETUP (Days 1-3)

### Why This Phase is Critical
The backend currently implements all services in **mock mode**, which means:
- Twilio SMS returns a fixed OTP `123456` instead of sending real SMS
- Stripe returns fake payment intents instead of real charges
- Firebase logs to console instead of sending notifications
- Onfido auto-approves verification after 5 seconds

**Without Phase 1 completion, the MVP cannot function with real users.**

---

### Task 1.1: Twilio SMS Configuration (Phone Authentication)

**What it does**: Enables phone-based user registration via SMS OTP
**Current Status**: Mock mode - fixed OTP `123456`
**Required For**: User authentication (AUTH-03, AUTH-04 in PRD)
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 4.1 Authentication Module

#### Example Flow (Chat Integration - Phone Registration)
```
User Flow:
1. User enters phone number in mobile app
2. App calls: POST /api/v1/auth/phone/request-otp
3. Backend sends SMS via Twilio with random 6-digit OTP
4. User receives SMS: "Twój kod: 459283"
5. User enters code in app
6. App calls: POST /api/v1/auth/phone/verify with code
7. Backend validates code against Twilio records
8. User authenticated → JWT token returned → Can chat and post tasks

Mock Mode (Current):
- User enters phone number
- Backend ignores Twilio
- Backend returns fixed OTP "123456"
- User can only use OTP "123456" to login
```

#### Setup Steps

**Step 1: Create Twilio Account**
1. Visit https://www.twilio.com/
2. Sign up for free trial account
3. Verify email address
4. Complete onboarding

**Step 2: Purchase Polish Phone Number**
1. Log into Twilio Console
2. Navigate to "Phone Numbers" → "Buy a Number"
3. Select country: Poland (+48)
4. Select number capabilities: SMS (must have SMS capability)
5. Purchase number (cost: ~$1/month)
6. Example: +48123456789

**Step 3: Get API Credentials**
1. Log into Twilio Console
2. Go to "Account" menu
3. Note down:
   - Account SID: `ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - Auth Token: `your_auth_token_here`
   - Phone Number: `+48123456789`

**Step 4: Update Backend Environment**
```bash
# Edit backend/.env
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_PHONE_NUMBER=+48123456789
```

**Step 5: Verify Implementation**
1. Start backend: `cd backend && npm run start:dev`
2. Check logs for: `"Twilio SMS service initialized"` (or similar)
3. Test with Postman:
   ```
   POST http://localhost:3000/api/v1/auth/phone/request-otp
   Body: { "phoneNumber": "+48123456789" }
   ```
4. Check your phone - should receive real SMS with OTP code

**Reference Code**:
- File: `backend/src/auth/auth.service.ts` lines 37-48
  ```typescript
  async requestOTP(phoneNumber: string): Promise<{ success: boolean }> {
    // Line 37-48: Checks if TWILIO_ACCOUNT_SID exists
    // If missing → uses mock OTP "123456"
    // If exists → sends real SMS via Twilio
  }
  ```
- File: `backend/src/auth/auth.service.ts` lines 253-272
  ```typescript
  // Twilio SMS sending logic
  ```

---

### Task 1.2: Stripe Payment Configuration (Payments & Contractor Payouts)

**What it does**: Enables payment processing for tasks and contractor earnings
**Current Status**: Mock mode - returns fake payment intents
**Required For**: Payment processing (PAY-01 through PAY-07 in PRD)
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 4.4 Payment Module

#### Example Flow (Chat Integration - Payment Processing)
```
Client Payment Flow:
1. Client creates task for "Help organize closet" - Price: 100 PLN
2. App calls: POST /api/v1/payments/create-payment-intent
3. Backend creates Stripe payment intent for 100 PLN
4. Client enters credit card details
5. Payment authorized → Contractor accepts task
6. Contractor completes task → Client confirms
7. Backend calls: POST /api/v1/payments/capture-payment
8. Payment captured → Released to contractor (83 PLN)
9. Platform keeps 17 PLN commission

Mock Mode (Current):
- Payment intent always created with fake ID
- No real charge attempted
- No contractor payout happens
```

#### Setup Steps

**Step 1: Create Stripe Account**
1. Visit https://stripe.com/
2. Sign up for free account
3. Verify email and set up business details
4. Complete identity verification

**Step 2: Enable Stripe Connect (Contractor Accounts)**
1. Log into Stripe Dashboard
2. Go to "Settings" → "Connect Settings"
3. Enable Connect for your platform (Stripe needs platform setup)
4. Configure branding and terms

**Step 3: Configure Webhook**
1. Go to "Developers" → "Webhooks"
2. Create webhook endpoint
3. Webhook URL: `https://api.szybkafucha.pl/api/v1/payments/webhook`
4. Events to receive: `payment_intent.succeeded`, `payment_intent.payment_failed`

**Step 4: Get API Credentials**
1. Go to "Developers" → "API Keys"
2. Note down:
   - Publishable Key: `pk_test_xxxxxxxxxxxxxxxxxxxx` (or `pk_live_...` for production)
   - Secret Key: `sk_test_xxxxxxxxxxxxxxxxxxxx` (or `sk_live_...` for production)
3. Copy Webhook Secret from webhook configuration

**Step 5: Update Backend Environment**
```bash
# Edit backend/.env
STRIPE_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxx
STRIPE_PLATFORM_FEE_PERCENT=17
```

**Step 6: Verify Implementation**
1. Start backend: `cd backend && npm run start:dev`
2. Test with Postman:
   ```
   POST http://localhost:3000/api/v1/payments/create-payment-intent
   Body: {
     "amount": 100,
     "currency": "pln",
     "taskId": "task-123"
   }
   Response should have: "client_secret": "pi_test_xxxxxxxxxxxx_secret_xxxxxxx"
   ```
3. Use Stripe test card: `4242 4242 4242 4242` (valid test card)

**Reference Code**:
- File: `backend/src/payments/payments.service.ts` lines 41-48
  ```typescript
  // Mock check: if STRIPE_SECRET_KEY missing, returns fake payment intent
  // If exists: creates real payment intent via Stripe API
  ```

---

### Task 1.3: Firebase Cloud Messaging Configuration (Push Notifications)

**What it does**: Enables push notifications for tasks, messages, and status updates
**Current Status**: Mock mode - logs to console instead of sending
**Required For**: Notifications (RT-04 in PRD)
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 4.5 Real-time Module

#### Example Flow (Chat Integration - Incoming Message Notification)
```
When Contractor Sends Message to Client:
1. Contractor types message in chat: "I'll be there in 5 minutes"
2. App calls: POST /api/v1/messages/send
3. Backend broadcasts via WebSocket (real-time)
4. Backend also sends push notification:
   - Notification: "New message from John: 'I'll be there in 5 minutes'"
   - Sends to client's phone using Firebase Cloud Messaging (FCM)
5. Client's phone receives notification even if app is closed
6. Client taps notification → App opens chat screen

Mock Mode (Current):
- Notification just logged to backend console
- Client's phone receives nothing
- Client must have app open to see messages
```

#### Setup Steps

**Step 1: Create Firebase Project**
1. Visit https://console.firebase.google.com/
2. Click "Create project"
3. Project name: "Szybka Fucha"
4. Accept analytics terms
5. Create project (takes 1-2 minutes)

**Step 2: Enable Cloud Messaging**
1. Open Firebase project
2. Go to "Project Settings" (gear icon)
3. Go to "Service Accounts" tab
4. Click "Generate New Private Key"
5. Save JSON file securely

**Step 3: Extract Credentials from JSON**
Open the downloaded JSON file and extract:
```json
{
  "type": "service_account",
  "project_id": "your-project-id",
  "private_key_id": "...",
  "private_key": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n",
  "client_email": "firebase-adminsdk-xxxxx@your-project-id.iam.gserviceaccount.com",
  "client_id": "...",
  "auth_uri": "...",
  "token_uri": "...",
  "auth_provider_x509_cert_url": "...",
  "client_x509_cert_url": "..."
}
```

**Step 4: Update Backend Environment**
```bash
# Edit backend/.env
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project-id.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE_WITH_\n_ESCAPED_NEWLINES\n-----END PRIVATE KEY-----\n"
```

**Step 5: Verify Implementation**
1. Start backend: `cd backend && npm run start:dev`
2. Check logs for: Firebase initialization message
3. Backend will now send real notifications to mobile apps

**Reference Code**:
- File: `backend/src/notifications/notifications.service.ts` lines 33-44
  ```typescript
  // Mock check: if FIREBASE_PROJECT_ID missing, logs to console
  // If exists: sends real notification via Firebase Admin SDK
  ```

---

### Task 1.4: JWT Secret Configuration (Security)

**What it does**: Secures user authentication tokens
**Current Status**: Weak development secret
**Required For**: Session security
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 5.3 Database Schema

#### Why This Matters
```
Weak JWT Secret (Current - UNSAFE):
- Can be easily brute-forced
- Attackers could forge fake authentication tokens
- Users' sessions could be hijacked

Strong JWT Secret (Production - SECURE):
- 48+ random characters
- Cannot be brute-forced
- Only valid tokens are those signed by backend
```

#### Setup Steps

**Step 1: Generate Strong Secret**
```bash
# Generate 48-character random secret
openssl rand -base64 48
# Output: eXample+outputOf/random+secretHere==...
```

**Step 2: Update Backend Environment**
```bash
# Edit backend/.env
JWT_SECRET=<PASTE_GENERATED_SECRET_HERE>
JWT_EXPIRES_IN=30d
```

**Step 3: Verify Implementation**
1. Start backend: `cd backend && npm run start:dev`
2. JWT will now use strong secret for all token generation

---

### Task 1.5: PostgreSQL Database Configuration (Data Persistence)

**What it does**: Stores all application data (users, tasks, messages, payments)
**Current Status**: Configured for localhost development
**Required For**: Data persistence
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 5.3 Database Schema

#### Setup Steps

**Step 1: Provision PostgreSQL 15+ with PostGIS**

Choose one of these providers:
- **AWS RDS** (if using AWS ECS)
- **DigitalOcean Managed Database**
- **Azure Database for PostgreSQL**
- **Render.com PostgreSQL**
- **Railway.app PostgreSQL**

Common settings to request:
- PostgreSQL version: 15+
- Region: Closest to your users (EU recommended for Poland)
- Extensions: PostGIS (required for location queries)
- Backup: Daily automated backups

**Step 2: Create Database and User**
```sql
-- Connect to PostgreSQL and run:
CREATE DATABASE szybkafucha_prod;
CREATE USER szybkafucha_prod WITH PASSWORD '<STRONG_PASSWORD>';
ALTER ROLE szybkafucha_prod CREATEDB;
GRANT ALL PRIVILEGES ON DATABASE szybkafucha_prod TO szybkafucha_prod;

-- Enable PostGIS extension
\c szybkafucha_prod
CREATE EXTENSION IF NOT EXISTS postgis;
```

**Step 3: Update Backend Environment**
```bash
# Edit backend/.env
DATABASE_HOST=your-db-host.com
DATABASE_PORT=5432
DATABASE_USERNAME=szybkafucha_prod
DATABASE_PASSWORD=<STRONG_PASSWORD_HERE>
DATABASE_NAME=szybkafucha_prod
```

**Step 4: CRITICAL - Disable TypeORM Synchronization**
```typescript
// Edit backend/src/app.module.ts
// Find TypeOrmModule.forRoot() configuration
TypeOrmModule.forRoot({
  // ... other config
  synchronize: false,  // CRITICAL: Must be false in production
})
```

**Step 5: Verify Connection**
1. Start backend: `cd backend && npm run start:dev`
2. Check logs for: `"TypeORM connection initialized"` (or similar)
3. Verify in database: Should see tables created (users, tasks, messages, payments, etc.)

---

### Task 1.6: Redis Configuration (Caching & Sessions)

**What it does**: Stores OTP codes, user sessions, and cached data
**Current Status**: Configured for localhost without password
**Required For**: OTP storage, rate limiting
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 5.1 System Overview

#### Setup Steps

**Step 1: Provision Redis 7+**

Choose one of these providers:
- **AWS ElastiCache**
- **DigitalOcean Redis**
- **Azure Cache for Redis**
- **Redis Cloud**
- **Upstash**

Common settings to request:
- Redis version: 7+
- Memory: 1GB minimum
- Password: Required (not optional)
- Region: Same as PostgreSQL

**Step 2: Update Backend Environment**
```bash
# Edit backend/.env
REDIS_HOST=your-redis-host.com
REDIS_PORT=6379
REDIS_PASSWORD=<STRONG_PASSWORD_HERE>
```

**Step 3: Verify Connection**
1. Start backend: `cd backend && npm run start:dev`
2. Check logs for: Redis connection message
3. Test OTP storage: Request OTP via `/auth/phone/request-otp` - should be stored in Redis

---

## PHASE 2: MOBILE APP PRODUCTION CONFIGURATION (Days 1-2, Parallel with Phase 1)

### Why This Phase is Critical
The mobile app currently has **two hardcoded development URLs** that must be changed to production URLs before it can communicate with the real backend. Additionally, **developer mode must be disabled** to test real authentication flows.

---

### Task 2.1: API Base URL Configuration

**What it does**: Tells mobile app where to find the backend API
**Current Status**: Hardcoded to `http://localhost:3000/api/v1`
**Required For**: All API communication
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 5.4 API Endpoints

#### Setup Steps

**Step 1: Edit API Configuration**
```dart
// File: mobile/lib/core/api/api_config.dart
// Line 5: DISABLE dev mode
static const bool devModeEnabled = false;  // Change from: true

// Line 17: Change to production URL
static const String baseUrl = 'https://api.szybkafucha.pl/api/v1';  // Change from: 'http://localhost:3000/api/v1'
```

**Step 2: Rebuild Mobile App**
```bash
cd mobile
flutter clean
flutter pub get
flutter run
```

**Step 3: Verify Configuration**
- Open mobile app
- App should now attempt to connect to production API
- If production backend is not yet running, app will show connection errors (expected)

**Reference Code**:
- File: `mobile/lib/core/api/api_config.dart` lines 5, 17

---

### Task 2.2: WebSocket URL Configuration

**What it does**: Tells mobile app where to find the real-time WebSocket server
**Current Status**: Hardcoded to `ws://localhost:3000`
**Required For**: Chat, location tracking, status updates
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 4.5 Real-time Module

#### Example Flow (Chat Integration - Real-time Message Delivery)
```
With Dev Mode Enabled (Current):
1. Contractor types message
2. WebSocket connects to localhost:3000 (doesn't exist if not running locally)
3. App simulates incoming message after 5-second delay
4. Message appears in chat (but not real - from other user's perspective)

With Dev Mode Disabled (Production):
1. Contractor types message
2. WebSocket connects to wss://api.szybkafucha.pl
3. Message sent to real backend via WebSocket
4. Backend broadcasts to all users in task room
5. Client's app receives real message instantly
6. Both users see conversation synchronized
```

#### Setup Steps

**Step 1: Edit WebSocket Configuration**
```dart
// File: mobile/lib/core/config/websocket_config.dart
// Line 9: Change to production WebSocket URL
static const String webSocketUrl = 'wss://api.szybkafucha.pl';  // Change from: 'ws://localhost:3000'

// Line 52: DISABLE dev mode
static const bool devModeEnabled = false;  // Change from: true
```

**Step 2: Rebuild Mobile App**
```bash
cd mobile
flutter clean
flutter pub get
flutter run
```

**Step 3: Verify Configuration**
- Open mobile app
- Chat screen should now use real WebSocket connection
- Messages will synchronize in real-time with backend

**Reference Code**:
- File: `mobile/lib/core/config/websocket_config.dart` lines 9, 52

---

### Task 2.3: Google Sign-In Configuration (Phone Registration Alternative)

**What it does**: Allows users to register and login via Google account
**Current Status**: No client IDs configured
**Required For**: OAuth authentication (AUTH-01 in PRD)
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 4.1 Authentication Module

#### Example Flow (Chat Integration - User Registration via Google)
```
User Registration Flow:
1. New user opens app
2. Taps "Sign in with Google"
3. Browser opens Google login
4. User enters Google email and password
5. User taps "Allow" to give app permission to email/profile
6. App receives ID token from Google
7. App sends token to backend: POST /api/v1/auth/google
8. Backend verifies token with Google
9. User authenticated → JWT token returned
10. User can now post tasks and chat
```

#### Setup Steps - iOS

**Part A: Google Cloud Console Setup**
1. Visit https://console.cloud.google.com/
2. Create new project or select existing
3. Enable Google Sign-In API:
   - Search for "Google+ API"
   - Click "Enable"
4. Create OAuth 2.0 credentials:
   - Go to "Credentials" in left menu
   - Click "Create Credentials" → "OAuth 2.0 Client ID"
   - Application type: "iOS"
   - Bundle ID: `pl.szybkafucha.mobile`
   - Copy the Client ID

**Part B: iOS Configuration**
1. Open Xcode: `mobile/ios/Runner.xcworkspace`
2. Select Runner project
3. Edit `Info.plist` in Runner target
4. Add URL scheme for Google Sign-In:
   ```xml
   <key>CFBundleURLTypes</key>
   <array>
     <dict>
       <key>CFBundleURLSchemes</key>
       <array>
         <string>com.googleusercontent.apps.YOUR_IOS_CLIENT_ID</string>
       </array>
     </dict>
   </array>
   <key>GIDClientID</key>
   <string>YOUR_IOS_CLIENT_ID.apps.googleusercontent.com</string>
   ```
5. Replace `YOUR_IOS_CLIENT_ID` with your actual Client ID

#### Setup Steps - Android

**Part A: Get SHA-1 Certificate Fingerprint**
```bash
cd mobile/android
# For debug keystore (dev):
./gradlew signingReport

# Or manually:
keytool -list -v -keystore ~/.android/debug.keystore -alias androiddebugkey -storepass android -keypass android
```

**Part B: Google Cloud Console Setup**
1. Create OAuth 2.0 credentials for Android:
   - Application type: "Android"
   - Package name: `pl.szybkafucha.mobile`
   - SHA-1 certificate fingerprint: (from step A)
   - Copy the Client ID

**Part C: Android Configuration**
1. Android automatically configured via `google-services.json` (see Task 2.5)

---

### Task 2.4: Apple Sign-In Configuration (Phone Registration Alternative)

**What it does**: Allows users to register and login via Apple account
**Current Status**: Implementation complete, needs Apple Developer setup
**Required For**: OAuth authentication (AUTH-02 in PRD)
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 4.1 Authentication Module

#### Example Flow (Chat Integration - User Registration via Apple)
```
Similar to Google Sign-In but using Apple ID
- User taps "Sign in with Apple"
- System shows Apple ID login dialog
- User authenticates with Face ID / Touch ID / Password
- App receives ID token from Apple
- Backend verifies token with Apple
- User authenticated → Can use app
```

#### Setup Steps

**Part A: Apple Developer Portal**
1. Visit https://developer.apple.com/
2. Go to "Certificates, Identifiers & Profiles"
3. Create App ID:
   - Type: App IDs
   - Bundle ID: `pl.szybkafucha.mobile`
4. Create Service ID: `pl.szybkafucha.mobile`
5. Configure "Sign in with Apple":
   - Email domain: `szybkafucha.pl`
   - Return URL: `https://api.szybkafucha.pl/api/v1/auth/apple/callback`
6. Create Key for "Sign in with Apple":
   - Save Key ID and Team ID securely

**Part B: iOS Configuration**
1. Open Xcode: `mobile/ios/Runner.xcworkspace`
2. Select Runner project
3. Go to "Signing & Capabilities" tab
4. Click "+ Capability"
5. Add "Sign in with Apple" capability
6. Build app: `flutter build ios`

---

### Task 2.5: Firebase Configuration (Mobile)

**What it does**: Enables push notifications and Google Sign-In integration on mobile
**Current Status**: Configuration files missing
**Required For**: Push notifications, Google Sign-In
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 4.5 Real-time Module

#### Setup Steps - iOS

**Step 1: Create Firebase iOS App**
1. Open Firebase Console (same project from Task 1.3)
2. Go to "Project Settings" (gear icon)
3. Click "Add app" → Select iOS
4. Bundle ID: `pl.szybkafucha.mobile`
5. App nickname: "Szybka Fucha iOS"
6. Click "Register app"
7. Download `GoogleService-Info.plist`

**Step 2: Add to Xcode**
1. Open Xcode: `mobile/ios/Runner.xcworkspace`
2. Drag and drop `GoogleService-Info.plist` into Xcode
3. Check "Copy items if needed"
4. Select Runner target
5. Build app: `flutter build ios`

#### Setup Steps - Android

**Step 1: Create Firebase Android App**
1. Open Firebase Console (same project)
2. Go to "Project Settings"
3. Click "Add app" → Select Android
4. Package name: `pl.szybkafucha.mobile`
5. App nickname: "Szybka Fucha Android"
6. Upload `SHA-1 certificate fingerprint` (from Task 2.3)
7. Click "Register app"
8. Download `google-services.json`

**Step 2: Add to Android Project**
1. Copy `google-services.json` to: `mobile/android/app/`
2. Build app: `flutter build apk`

---

### Task 2.6: Android Release Signing (Google Play Store)

**What it does**: Signs app for Google Play Store release
**Current Status**: Using debug keystore (TODO comment)
**Required For**: Google Play Store release
**PRD Reference**: `tasks/prd-szybka-fucha.md` Section 6.1 Design System

#### Setup Steps

**Step 1: Generate Release Keystore**
```bash
cd mobile/android
keytool -genkey -v -keystore release-keystore.jks -keyalg RSA -keysize 2048 -validity 10000 -alias szybkafucha
# Follow prompts to enter passwords and info
```

**Step 2: Create `key.properties` File**
```bash
# Create file: mobile/android/key.properties
# Content:
cat > key.properties << EOF
storePassword=<YOUR_KEYSTORE_PASSWORD>
keyPassword=<YOUR_KEY_PASSWORD>
keyAlias=szybkafucha
storeFile=release-keystore.jks
EOF
```

**Step 3: Add to .gitignore**
```bash
# Edit mobile/.gitignore and add:
android/key.properties
android/release-keystore.jks
```

**Step 4: Update build.gradle.kts**
```kotlin
// File: mobile/android/app/build.gradle.kts
// Add BEFORE android block:
def keystoreProperties = new Properties()
def keystorePropertiesFile = rootProject.file('key.properties')
if (keystorePropertiesFile.exists()) {
    keystoreProperties.load(new FileInputStream(keystorePropertiesFile))
}

android {
    signingConfigs {
        release {
            keyAlias keystoreProperties['keyAlias']
            keyPassword keystoreProperties['keyPassword']
            storeFile keystoreProperties['storeFile'] ? file(keystoreProperties['storeFile']) : null
            storePassword keystoreProperties['storePassword']
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
        }
    }
}
```

**Step 5: Build Signed Release APK**
```bash
cd mobile
flutter build apk --release
# Output: mobile/build/app/outputs/flutter-apk/app-release.apk
```

---

## PHASE 3: SPECIFIC INTEGRATION EXAMPLES

### Example 1: Phone Number Verification (SMS OTP)

**Requirement**: User can register via phone number with SMS OTP verification

**What happens step-by-step**:

```
1. USER ENTERS PHONE NUMBER
   Mobile App → TextField shows "+48"
   User types: "123456789"

2. REQUEST OTP
   Mobile App → POST /api/v1/auth/phone/request-otp
   Body: { "phoneNumber": "+48123456789" }

3. BACKEND VALIDATES
   Backend receives phone number
   Checks if phone not already registered
   Generates random 6-digit OTP (e.g., "459283")
   Stores OTP in Redis: key="otp:+48123456789" value="459283" (expires 10 min)

4. TWILIO SENDS SMS (REQUIRES TASK 1.1 COMPLETE)
   Backend calls Twilio API with:
   - To: "+48123456789"
   - From: "+48xxxxxxxxx" (your Polish Twilio number)
   - Body: "Kod weryfikacyjny Szybka Fucha: 459283"

5. USER RECEIVES SMS
   Phone buzzes with notification:
   "Kod weryfikacyjny Szybka Fucha: 459283"

6. USER ENTERS OTP IN APP
   User types "459283" in TextField
   Mobile App → POST /api/v1/auth/phone/verify
   Body: { "phoneNumber": "+48123456789", "otp": "459283" }

7. BACKEND VERIFIES
   Backend retrieves OTP from Redis
   Compares with user input
   If match:
     - Create User record
     - Generate JWT token
     - Return token to app
   If no match:
     - Return 401 error

8. APP STORES JWT
   Mobile app receives token
   Stores in secure storage
   Includes token in all future API requests
   User is authenticated

9. USER CAN NOW
   - Post tasks
   - Send messages (requires WebSocket connection)
   - Accept contractor jobs
   - Track contractor location
```

**Files Involved**:
- Mobile: `mobile/lib/features/auth/screens/phone_auth_screen.dart`
- Backend: `backend/src/auth/auth.service.ts` lines 37-48 (request), lines 253-272 (verify)
- Backend: `backend/src/auth/auth.controller.ts` (endpoints)
- Infrastructure: Twilio account with phone number (Task 1.1)

**Testing Steps**:
1. Complete Task 1.1 (Twilio setup)
2. Start backend: `npm run start:dev`
3. Open mobile app
4. Go to auth screen
5. Enter your real phone number
6. Wait for SMS
7. Enter OTP from SMS
8. Should be authenticated

---

### Example 2: Chat Integration (Real-time Messages)

**Requirement**: Users can send and receive real-time messages

**What happens step-by-step**:

```
USER 1 (CLIENT) SENDS MESSAGE:
1. Client posts task for "Help move furniture"
2. Contractor accepts task
3. Both users open chat screen
4. Client types: "I'll be home at 3pm"
5. Client taps Send button

MOBILE APP (CLIENT SIDE):
1. Creates Message object
2. Stores in local database (offline support)
3. Connects to WebSocket (requires Task 2.2 complete):
   - Namespace: /realtime
   - Room: task-{taskId}
   - Auth: JWT token in headers
4. Emits event: "message:send"
   {
     "taskId": "task-123",
     "content": "I'll be home at 3pm",
     "senderId": "user-client-1",
     "senderName": "Anna",
     "timestamp": "2026-01-19T14:30:00Z"
   }

BACKEND (SERVER SIDE):
1. Receives message event via WebSocket
2. Validates JWT token (user is authenticated)
3. Creates Message record in database
4. Changes message status: "pending" → "sent"
5. Broadcasts to all users in room: "message:received"
   {
     "messageId": "msg-456",
     "taskId": "task-123",
     "content": "I'll be home at 3pm",
     "senderId": "user-client-1",
     "senderName": "Anna",
     "status": "sent",
     "timestamp": "2026-01-19T14:30:00Z"
   }

USER 2 (CONTRACTOR) RECEIVES MESSAGE:
1. Contractor's app receives "message:received" event
2. Adds message to chat list in UI
3. Plays notification sound (if not in chat)
4. Contractor's app emits "message:read"
5. Backend updates message status: "sent" → "delivered" → "read"

PUSH NOTIFICATION (IF APP CLOSED):
1. Backend sends Firebase Cloud Messaging (requires Task 1.3 complete)
2. Sends to contractor's device token
3. Notification: "New message from Anna: 'I'll be home at 3pm'"
4. Contractor sees notification on home screen
5. Taps notification → App opens → Chat screen shows message
```

**Files Involved**:
- Mobile: `mobile/lib/features/chat/screens/chat_screen.dart`
- Mobile: `mobile/lib/features/chat/providers/chat_provider.dart`
- Mobile: `mobile/lib/core/config/websocket_config.dart` (WebSocket config)
- Backend: `backend/src/realtime/realtime.gateway.ts` (WebSocket server)
- Backend: `backend/src/messages/messages.service.ts` (message logic)
- Infrastructure: Firebase setup (Task 1.3), WebSocket configuration (Task 2.2)

**Testing Steps**:
1. Complete Tasks 1.3, 2.2 (Firebase, WebSocket URLs)
2. Start backend: `npm run start:dev`
3. Open mobile app as User 1
4. Create task
5. Open second mobile instance as User 2 (or use multiple devices)
6. User 2 accepts task
7. Both open chat
8. Send message from User 1
9. Should appear instantly on User 2 (if dev mode disabled)
10. Should see status change: pending → sent → delivered → read

---

### Example 3: Google Sign-In (OAuth)

**Requirement**: Users can register/login via Google account

**What happens step-by-step**:

```
USER TAPS "SIGN IN WITH GOOGLE":
1. Mobile app shows dialog
2. Redirects to Google Sign-In page

GOOGLE AUTHENTICATION:
1. User enters Google email (e.g., user@gmail.com)
2. User enters Google password
3. User grants permission to app:
   "Szybka Fucha wants to:
   - Access your email address
   - Access your profile information"
4. User taps "Allow"

GOOGLE RETURNS ID TOKEN:
1. Google generates ID token (signed JWT with user info)
2. Returns to mobile app

MOBILE APP SENDS TO BACKEND:
1. Mobile app receives ID token
2. Calls: POST /api/v1/auth/google
   Body: { "idToken": "eyJhbGc..." }

BACKEND VALIDATES TOKEN:
1. Backend receives ID token
2. Makes request to Google: "Is this token valid?"
3. Google verifies signature and returns:
   {
     "email": "user@gmail.com",
     "name": "John Doe",
     "picture": "https://...",
     "sub": "1234567890" (Google user ID)
   }
4. Backend checks: Is user with this email already registered?
   - If YES: Return existing JWT token
   - If NO: Create new User record, return JWT token

MOBILE APP NOW AUTHENTICATED:
1. Receives JWT token from backend
2. Stores in secure storage
3. User can access all features
```

**Files Involved**:
- Mobile: `mobile/lib/core/services/google_sign_in_service.dart`
- Backend: `backend/src/auth/auth.service.ts` (Google verification logic)
- Backend: `backend/src/auth/auth.controller.ts` (POST /auth/google endpoint)
- Infrastructure: Google OAuth credentials (Task 2.3)

**Testing Steps**:
1. Complete Task 2.3 (Google Sign-In setup)
2. Start backend: `npm run start:dev`
3. Open mobile app
4. Tap "Sign in with Google"
5. Select Google account (or log in)
6. Grant permission
7. Should be authenticated and in main app

---

### Example 4: Push Notifications (New Task)

**Requirement**: Contractor receives notification when new task matches their profile

**What happens step-by-step**:

```
CLIENT POSTS NEW TASK:
1. Client: "I need help cleaning apartment - 200 PLN"
2. Client selects services: "Cleaning"
3. Client selects location: "Warsaw, Centrum"
4. Client submits task

BACKEND PROCESSES TASK:
1. Task created in database
2. Backend searches contractors with:
   - Service = "Cleaning"
   - Location within 5km of task
   - Status = "Available"
3. Finds matching contractors: Anna, Piotr, Magda

FIREBASE CLOUD MESSAGING:
1. For each matching contractor:
   - Backend retrieves device token from User record
   - Sends push notification via Firebase (requires Task 1.3)
   - Notification:
     {
       "title": "Nowe zlecenie!",
       "body": "Sprzątanie - 200 PLN, Centrum Warszawy",
       "taskId": "task-123"
     }

CONTRACTOR'S PHONE (IF APP CLOSED):
1. Receives notification: "Nowe zlecenie! Sprzątanie - 200 PLN..."
2. Phone vibrates/sounds
3. Contractor sees notification on home screen
4. Taps notification

MOBILE APP:
1. Receives notification tap
2. Deep links to task details screen
3. Shows: "Sprzątanie - 200 PLN, Centrum Warszawy, Klient: Anna"
4. Contractor can tap "Accept" to take the task

IF APP ALREADY OPEN:
1. Notification arrives via WebSocket (real-time)
2. In-app banner shows: "Nowe zlecenie!"
3. Tasks list auto-refreshes
4. New task appears at top
5. Contractor taps to view details
6. Taps "Accept"
```

**Files Involved**:
- Backend: `backend/src/notifications/notifications.service.ts` (notification sending)
- Backend: `backend/src/tasks/tasks.service.ts` (matching logic)
- Mobile: `mobile/lib/core/providers/websocket_provider.dart` (notification reception)
- Infrastructure: Firebase Cloud Messaging (Task 1.3)

**Testing Steps**:
1. Complete Task 1.3 (Firebase setup)
2. Have mobile app open on device 1 (as Contractor)
3. Post task from device 2 (as Client)
4. Close device 1 app
5. Post matching task from device 2
6. Device 1 should receive notification
7. Tap notification → Should open task details

---

## PHASE 4: TESTING & VALIDATION (Days 3-5)

### Task 4.1: Backend Integration Testing

**What it tests**: All external services work correctly with production credentials

#### Test 1: Twilio SMS Delivery
```bash
# Start backend with production Twilio credentials
npm run start:dev

# Test with Postman:
POST http://localhost:3000/api/v1/auth/phone/request-otp
Body: { "phoneNumber": "+48123456789" }  # Use your real phone number

# Expected:
- Response: { "success": true }
- Your phone: Receives SMS with OTP code
```

#### Test 2: Stripe Payment Processing
```bash
POST http://localhost:3000/api/v1/payments/create-payment-intent
Body: {
  "amount": 10000,  # 100.00 PLN in cents
  "currency": "pln",
  "taskId": "task-123"
}

# Expected:
- Response includes "client_secret": "pi_test_xxx_secret_xxx"
- Can use Stripe test card: 4242 4242 4242 4242
```

#### Test 3: Firebase Notifications
```typescript
// Backend sends notification via Stripe webhook
// Contractor should receive push notification on phone
// Check Firebase Console: Logs show notification delivery
```

#### Test 4: WebSocket Connection
```bash
# Connect to WebSocket from mobile app or Postman
ws://localhost:3000/realtime
# With JWT token in headers

# Should connect successfully and receive location/message events
```

---

### Task 4.2: Mobile End-to-End Testing

**Registration Flow**:
- [ ] Phone OTP registration works
- [ ] Google Sign-In works
- [ ] Apple Sign-In works (iOS only)
- [ ] JWT token stored and persisted

**Task Creation Flow**:
- [ ] Create task with all 6 categories
- [ ] Select location on map
- [ ] Set price
- [ ] Task appears in contractor list

**Payment Flow**:
- [ ] Enter credit card details
- [ ] Payment processed successfully
- [ ] Contractor can accept task

**Chat Flow**:
- [ ] Two users can open chat
- [ ] Send message appears instantly
- [ ] Message status changes: pending → sent → delivered → read
- [ ] Can send messages offline and they queue

**Location Tracking Flow**:
- [ ] Contractor enables location sharing
- [ ] Client sees real-time location on map
- [ ] Distance and ETA calculated correctly

---

## PHASE 5: DEPLOYMENT & LAUNCH (Days 6-8)

### Task 5.1: Backend Deployment

**Choose Deployment Platform**:
- AWS ECS (recommended in PRD)
- Heroku with add-ons
- Railway.app
- DigitalOcean App Platform
- Render.com

**Deployment Steps**:
1. Deploy backend with production environment variables
2. Configure domain: `api.szybkafucha.pl`
3. Set up SSL certificate (Let's Encrypt, free)
4. Run health check: `GET /health`

---

### Task 5.2: Mobile App Release

**iOS App Store**:
1. Create App Store Connect account
2. Create app listing with screenshots and description
3. Upload build via Xcode or Transporter
4. Wait for Apple review (24-48 hours)

**Android Google Play Store**:
1. Create Google Play Developer account ($25 one-time)
2. Create app listing with screenshots and feature graphics
3. Upload signed APK
4. Launch to production

---

## PHASE 6: MONITORING & SUPPORT (Ongoing)

### Task 6.1: Error Tracking

Set up **Sentry** for production error tracking:
```bash
# Install in backend
npm install @sentry/node

# Configure in backend/src/main.ts
import * as Sentry from '@sentry/node';
Sentry.init({
  dsn: 'your_sentry_dsn_here',
  environment: 'production',
});
```

### Task 6.2: Performance Monitoring

Recommended: New Relic, DataDog, or similar

---

## PHASE 7: SOFT LAUNCH (Days 9-11)

### Soft Launch Checklist

- [ ] Launch to 50-100 users (week 1)
- [ ] Monitor error rates in Sentry
- [ ] Check WebSocket stability
- [ ] Verify payment success rate > 95%
- [ ] Monitor SMS delivery rate > 98%
- [ ] Collect user feedback
- [ ] Fix critical bugs immediately
- [ ] Gradually expand to more users (week 2)

---

## QUICK REFERENCE: Environment Variables

### Backend (.env)

```env
# Server
NODE_ENV=production
PORT=3000
API_PREFIX=api/v1

# Database
DATABASE_HOST=your-db-host.com
DATABASE_PORT=5432
DATABASE_USERNAME=szybkafucha_prod
DATABASE_PASSWORD=<STRONG_PASSWORD>
DATABASE_NAME=szybkafucha_prod

# Redis
REDIS_HOST=your-redis-host.com
REDIS_PORT=6379
REDIS_PASSWORD=<STRONG_PASSWORD>

# JWT
JWT_SECRET=<48_CHARACTER_RANDOM_STRING>
JWT_EXPIRES_IN=30d

# Twilio (SMS)
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_PHONE_NUMBER=+48123456789

# Stripe (Payments)
STRIPE_SECRET_KEY=sk_live_xxxxxxxxxxxxxxxxxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxx
STRIPE_PLATFORM_FEE_PERCENT=17

# Firebase (Notifications)
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project-id.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"

# Onfido (KYC - Optional for MVP)
ONFIDO_API_TOKEN=api_live_xxxxxxxxxxxxxxxxxxxxxxxx
```

### Mobile Configuration

**api_config.dart**:
```dart
devModeEnabled = false
baseUrl = 'https://api.szybkafucha.pl/api/v1'
```

**websocket_config.dart**:
```dart
devModeEnabled = false
webSocketUrl = 'wss://api.szybkafucha.pl'
```

---

## SUMMARY: WHAT MUST BE DONE BEFORE MVP START

### Critical Tasks (Must Complete):

**Backend Setup (3 days)**:
1. ✅ Twilio SMS account + credentials
2. ✅ Stripe account + API keys + Stripe Connect
3. ✅ Firebase project + service account
4. ✅ JWT secret generation
5. ✅ PostgreSQL database provisioning
6. ✅ Redis instance provisioning

**Mobile Configuration (1-2 days)**:
1. ✅ Change API URL from localhost
2. ✅ Change WebSocket URL from localhost
3. ✅ Disable dev mode flags
4. ✅ Google Sign-In credentials + config
5. ✅ Apple Sign-In setup
6. ✅ Firebase config files (google-services.json, GoogleService-Info.plist)
7. ✅ Android release signing setup

**Testing (2-3 days)**:
1. ✅ Backend integration tests with real services
2. ✅ Mobile E2E tests through all user flows
3. ✅ Payment testing with real Stripe test cards

**Deployment (2-3 days)**:
1. ✅ Choose deployment platform
2. ✅ Deploy backend to production
3. ✅ Set up SSL certificates
4. ✅ Deploy mobile apps to app stores

**Total Time**: 7-11 days

---

## NEXT STEPS

1. **Start with Phase 1** (Backend setup) immediately - can be parallelized
2. **Simultaneously start Phase 2** (Mobile configuration) - quick 1-2 day task
3. **Phase 3-7** follow sequentially as dependencies complete
4. **Keep team informed** of external service setup progress

**Question for Product/PM**: Do we have external service budget approved (Twilio, Stripe, Firebase)?

---

**Document Version**: 1.0
**Date Created**: 2026-01-19
**Status**: Ready for Implementation
Perfect! I've created the comprehensive document you requested. Let me now create a progress tracking todo list for the implementation phases:

Update Todos

Phase 1: Backend External Service Setup

Task 1.1: Twilio SMS Configuration

Task 1.2: Stripe Payment Configuration

Task 1.3: Firebase Cloud Messaging Configuration

Task 1.4: JWT Secret Configuration

Task 1.5: PostgreSQL Database Configuration

Task 1.6: Redis Configuration

Phase 2: Mobile App Production Configuration

Task 2.1: API Base URL Configuration

Task 2.2: WebSocket URL Configuration

Task 2.3: Google Sign-In Configuration

Task 2.4: Apple Sign-In Configuration

Task 2.5: Firebase Configuration (Mobile)

Task 2.6: Android Release Signing

Phase 3: Backend Production Hardening

Phase 4: Testing & Validation

Phase 5: App Store Preparation

Phase 6: Infrastructure & Deployment

Phase 7: Post-Launch Monitoring
Excellent! I've successfully created the comprehensive MVP production readiness document you requested. Here's what has been completed:

Summary of Deliverables
1. Main Document Created: It_must_be_done_before_MVP_start.MD
This document includes:

✅ Executive Summary - Clear overview of 23 critical tasks across 6 phases

✅ Phase 1: Backend External Service Setup (7 tasks)

Twilio SMS configuration with step-by-step instructions
Stripe payment setup with Stripe Connect
Firebase Cloud Messaging setup
JWT secret generation
PostgreSQL production database
Redis production setup
✅ Phase 2: Mobile App Production Configuration (7 tasks)

API base URL change (localhost → production)
WebSocket URL change (localhost → production)
Google Sign-In setup with OAuth credentials
Apple Sign-In Apple Developer setup
Firebase mobile config files (google-services.json, GoogleService-Info.plist)
Android release signing with keystore
✅ Phase 3: Integration Examples (4 detailed flows)

Phone Number Verification - Complete SMS OTP flow with exact backend API calls
Chat Integration - Real-time message delivery with WebSocket architecture
Google Sign-In - OAuth token validation process
Push Notifications - Task matching and notification delivery
✅ Environment Variables Quick Reference - Complete .env template

✅ Testing Checklist - Specific test procedures for each integration

✅ Deployment Guide - Platform options and setup procedures

✅ Timeline - 7-11 days to MVP launch

✅ PRD Cross-References - Every major task references specific PRD sections

2. Progress Tracking Todo List
Created 20 todo items tracking all phases and tasks for implementation

3. Key Highlights
All examples include:

File paths and line numbers for quick code location
Environment variable templates ready to use
Code snippets showing before/after states
Testing procedures to verify each integration
Dependencies showing what must complete before what
What This Means for Your MVP Launch
You now have a complete, actionable blueprint for production readiness. The document answers all your original questions:

✅ "What must be done for fully functional MVP?" - All 23 tasks listed with dependencies
✅ "Step-by-step guide after analyzing PRDs?" - Each task has numbered steps with references
✅ "Test with backend not dev mode?" - Phase 2 & 4 explain how to disable dev mode and test real flows
✅ "Examples for chat, notifications, Google signin, phone verification?" - Phase 3 has 4 complete detailed flows
✅ "Reference to requirements in documentation?" - Every section cross-references PRD documents
Next Steps
To begin implementation, you should:

Start Phase 1 (backend external services) - These are foundation tasks that unblock everything else
Parallel Phase 2 (mobile configuration) - Quick configuration changes that can happen while Phase 1 is in progress
Follow the numbered tasks in sequence, marking them complete as you go
Would you like me to help you start implementing any specific phase, or do you need clarification on any of the prerequisites?